"use strict";(self.webpackChunkxpanse_website=self.webpackChunkxpanse_website||[]).push([[459],{9611:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>h,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"webhooks","title":"Webhooks","description":"xpanse exposes webhooks for other systems to update the status of tasks.","source":"@site/docs/webhooks.mdx","sourceDirName":".","slug":"/webhooks","permalink":"/xpanse/docs/webhooks","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"sidebar_position":11},"sidebar":"tutorialSidebar","previous":{"title":"UI","permalink":"/xpanse/docs/ui"},"next":{"title":"Workflows","permalink":"/xpanse/docs/workflows"}}');var i=t(4848),a=t(8453);const r={sidebar_position:11},o="Webhooks",h={},d=[{value:"Security",id:"security",level:2},{value:"Structure of HMAC signature",id:"structure-of-hmac-signature",level:3},{value:"Format of signature data",id:"format-of-signature-data",level:3},{value:"How validation works",id:"how-validation-works",level:3},{value:"Configuration for HMAC Key",id:"configuration-for-hmac-key",level:2}];function l(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"webhooks",children:"Webhooks"})}),"\n",(0,i.jsx)(n.p,{children:"xpanse exposes webhooks for other systems to update the status of tasks.\nCurrently, this is used for getting updates from deployment systems such as terra-boot and tofu-maker."}),"\n",(0,i.jsx)(n.h2,{id:"security",children:"Security"}),"\n",(0,i.jsx)(n.p,{children:"All webhooks are protected with HMAC by default.\nThe clients of the webhook must know the secret key from xpanse and use this secret key to generate signature."}),"\n",(0,i.jsx)(n.h3,{id:"structure-of-hmac-signature",children:"Structure of HMAC signature"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"x-signature: algorithm=HmacSHA256;headers=x-nonce-signature x-timestamp-signature;signature=d4fb456bc7621ed1c8099e8a1136997d6ad9b8613fc79a49b39833d4cb36080a\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The name of the header - ",(0,i.jsx)(n.strong,{children:"x-signature"}),"\nIt must contain algorithm name, headers used in the signature and then the actual signature.\nEach key and its value must be ",(0,i.jsx)(n.strong,{children:"equals ="})," separated, and each key-value pair must be separated with ",(0,i.jsx)(n.strong,{children:"semicolon ;"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Algorithm name must be a valid HMAC algorithm name."}),"\n",(0,i.jsx)(n.li,{children:"headers here refer to other headers sent with the request that are part of the signature payload."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"format-of-signature-data",children:"Format of signature data"}),"\n",(0,i.jsx)(n.p,{children:"Clients must first prepare the data in plain text and then sign it with the secret key to generate the signature.\nThe format of the data is"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"value of headers in the signature. Each header must be in a newline."}),"\n",(0,i.jsx)(n.li,{children:"Full URL to which the webhook request will be sent in a new line."}),"\n",(0,i.jsx)(n.li,{children:"Payload a string in a new line (request body)."}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"multi-line string",type:"info",children:(0,i.jsx)(n.p,{children:"The text to be signed must be a multi-line string with each line containing only one piece of information."})}),"\n",(0,i.jsx)(n.h3,{id:"how-validation-works",children:"How validation works"}),"\n",(0,i.jsx)(n.p,{children:"The client generates the signature based on the data such as headers, webhook URL and payload (request body).\nThe format of the signature's plain text data and the secret key is agreed between xpanse and\nother applications which will send data to xpanse via webhook APIs."}),"\n",(0,i.jsx)(n.p,{children:"On receiving the request, xpanse again tries to generate signature data from received data and\ngenerate the signature again. If this signature value matches to the signature value sent in the request header,\nthen the request is accepted. Otherwise, rejected with HTTP 401."}),"\n",(0,i.jsx)(n.h2,{id:"configuration-for-hmac-key",children:"Configuration for HMAC Key"}),"\n",(0,i.jsxs)(n.p,{children:["xpanse must configure the secret key for HMAC signature signing using the property ",(0,i.jsx)(n.strong,{children:"xpanse.webhook.hmac.request.signing.key"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"A random value can be generated using the below command on command line.\nThis will give a 32 byte (256 bit) secret key."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"openssl rand -hex 32\n"})}),"\n",(0,i.jsx)(n.p,{children:"Once the key is generated and finalized, it must be used on the client applications as described in their documentation."}),"\n",(0,i.jsx)(n.admonition,{title:"Sample key for non-production environments",type:"tip",children:(0,i.jsxs)(n.p,{children:["To provide better developer experience, the ",(0,i.jsx)(n.strong,{children:"dev"})," spring profile provides a sample key which can be used in non-production environments."]})})]})}function c(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var s=t(6540);const i={},a=s.createContext(i);function r(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);