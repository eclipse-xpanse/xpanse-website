"use strict";(self.webpackChunkxpanse_website=self.webpackChunkxpanse_website||[]).push([[1603],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),d=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=d(e.components);return i.createElement(s.Provider,{value:t},e.children)},c="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},h=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=d(n),h=a,m=c["".concat(s,".").concat(h)]||c[h]||p[h]||o;return n?i.createElement(m,r(r({ref:t},u),{},{components:n})):i.createElement(m,r({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:a,r[1]=l;for(var d=2;d<o;d++)r[d]=n[d];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}h.displayName="MDXCreateElement"},82667:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var i=n(87462),a=(n(67294),n(3905));const o={sidebar_position:3},r="Authentication and Authorization",l={unversionedId:"authentication-authorization",id:"authentication-authorization",title:"Authentication and Authorization",description:"With security being at the heart of Xpanse project, all entry points to the application are completely protected.",source:"@site/docs/authentication-authorization.md",sourceDirName:".",slug:"/authentication-authorization",permalink:"/xpanse/docs/authentication-authorization",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Architecture",permalink:"/xpanse/docs/architecture"},next:{title:"Configuration Language",permalink:"/xpanse/docs/configuration-language"}},s={},d=[{value:"OIDC",id:"oidc",level:2},{value:"OIDC Providers and its Configuration",id:"oidc-providers-and-its-configuration",level:3},{value:"Zitadel",id:"zitadel",level:2},{value:"Zitadel Provider Configuration",id:"zitadel-provider-configuration",level:3},{value:"Zitadel Consumer Configuration",id:"zitadel-consumer-configuration",level:3},{value:"Runtime",id:"runtime",level:4},{value:"UI",id:"ui",level:4},{value:"End Users Configuration",id:"end-users-configuration",level:4},{value:"Admin Users",id:"admin-users",level:4},{value:"Role Based Access Control - RBAC",id:"role-based-access-control---rbac",level:2},{value:"Roles",id:"roles",level:3},{value:"Role Assignment",id:"role-assignment",level:3},{value:"Role Validation",id:"role-validation",level:3},{value:"Execute authenticated APIs",id:"execute-authenticated-apis",level:3}],u={toc:d},c="wrapper";function p(e){let{components:t,...o}=e;return(0,a.kt)(c,(0,i.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"authentication-and-authorization"},"Authentication and Authorization"),(0,a.kt)("p",null,"With security being at the heart of Xpanse project, all entry points to the application are completely protected."),(0,a.kt)("h2",{id:"oidc"},"OIDC"),(0,a.kt)("p",null,"Authentication and Authorization are implemented using OIDC (OpenID Connect). This helps us to outsource the security\nlayer to an external ",(0,a.kt)("inlineCode",{parentName:"p"},"Identity Provider")," and thereby not storing any user data within Xpanse."),(0,a.kt)("h3",{id:"oidc-providers-and-its-configuration"},"OIDC Providers and its Configuration"),(0,a.kt)("p",null,"Similar to other integrations provided in Xpanse, the runtime can be extended to be integrated with any Identity\nProvider that supports OIDC standards. It is not limited to any specific product."),(0,a.kt)("p",null,"Any OIDC provider cannot be used directly out of the box. It needs a variety of configurations on the provider. From\nXpanse project, we aim to provide 'Infrastructure as Code' which will automate all required configuration on the\nIdentity provider."),(0,a.kt)("p",null,"All Identity provider related configuration on consumers can only be obtained only after the OIDC provider is fully\nconfigured with the consumer detail"),(0,a.kt)("h2",{id:"zitadel"},"Zitadel"),(0,a.kt)("p",null,"As a default implementation, Xpanse runtime is integrated with ",(0,a.kt)("a",{parentName:"p",href:"https://zitadel.com/"},"Zitadel")," Identity Provider."),(0,a.kt)("p",null,"To enable Zitadel authentication layer, the runtime must be started with ",(0,a.kt)("inlineCode",{parentName:"p"},"zitadel")," profile."),(0,a.kt)("p",null,"More details can be found ",(0,a.kt)("a",{parentName:"p",href:"/xpanse/docs/runtime"},"here"),"."),(0,a.kt)("h3",{id:"zitadel-provider-configuration"},"Zitadel Provider Configuration"),(0,a.kt)("p",null,"After starting the vanilla Zitadel application, all required configurations can be applied using the Terraform scripts\nprovided.\nAll steps required for initial configuration are\navailable ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/eclipse-xpanse/xpanse-iam/blob/main/zitadel/terraform/README.md"},"here"),"."),(0,a.kt)("h3",{id:"zitadel-consumer-configuration"},"Zitadel Consumer Configuration"),(0,a.kt)("p",null,"All generated configuration details can be obtained as\ndocumented ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/eclipse-xpanse/xpanse-iam/blob/main/zitadel/terraform/README.md#get-consumer-details"},"here"),"."),(0,a.kt)("h4",{id:"runtime"},"Runtime"),(0,a.kt)("p",null,"Runtime application needs the following properties to be set for the authentication and authorization to work."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"authorization-server-endpoint"),(0,a.kt)("li",{parentName:"ul"},"authorization-api-client-id"),(0,a.kt)("li",{parentName:"ul"},"authorization-api-client-secret"),(0,a.kt)("li",{parentName:"ul"},"authorization-swagger-ui-client-id")),(0,a.kt)("h4",{id:"ui"},"UI"),(0,a.kt)("p",null,"UI can be then started using the consumer details as\ndocumented ",(0,a.kt)("a",{parentName:"p",href:"/xpanse/docs/ui#starting-local-development-server"},"here"),"."),(0,a.kt)("h4",{id:"end-users-configuration"},"End Users Configuration"),(0,a.kt)("p",null,"At the moment, it is only feasible to create user only via the Zitadel UI as we do not have SMTP available which is\nneeded for self-registration of users."),(0,a.kt)("h4",{id:"admin-users"},"Admin Users"),(0,a.kt)("p",null,"By default, Zitadel provides a root user using which other users can be created and also made other administrators. Only\nthese users can add other end-users on Zitadel."),(0,a.kt)("h2",{id:"role-based-access-control---rbac"},"Role Based Access Control - RBAC"),(0,a.kt)("p",null,"We use OIDC providers to also implement RBAC on Xpanse runtime API and also in UI."),(0,a.kt)("h3",{id:"roles"},"Roles"),(0,a.kt)("p",null,"To keep our initial role configuration simple, the following roles are considered"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"user")," - this is the role allocated to end user."),(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"isv")," - this is the role allocated to ISV (independent software vendor) users."),(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"admin")," - this is the role allocated to administrators running Xpanse."),(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"Default Role")," - When no roles are assigned to a user, then every registered is by default assumed to have\nthe ",(0,a.kt)("inlineCode",{parentName:"p"},"user")," role.")),(0,a.kt)("h3",{id:"role-assignment"},"Role Assignment"),(0,a.kt)("p",null,"After the end users are registered/created on Zitadel, the administrator must assign roles to the user."),(0,a.kt)("p",null,"This option can be found on the UI under - users -> click on user -> Authorizations -> + New"),(0,a.kt)("h3",{id:"role-validation"},"Role Validation"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Each API method is configured to be allowed only for specific roles. ",(0,a.kt)("inlineCode",{parentName:"li"},"Spring Security")," fetches the user information\nfrom ",(0,a.kt)("inlineCode",{parentName:"li"},"Identity Provider")," and based on the roles allocated to the user, we decide if the user is allowed to access an\nAPI or not. If the user is not authorized to access, then API returns HTTP code ",(0,a.kt)("inlineCode",{parentName:"li"},"403"),"."),(0,a.kt)("li",{parentName:"ol"},"Xpanse UI fetches the user information from ",(0,a.kt)("inlineCode",{parentName:"li"},"Identity Provider")," and based on the roles allocated to the user, menu\noptions are displayed in the UI.")),(0,a.kt)("h3",{id:"execute-authenticated-apis"},"Execute authenticated APIs"),(0,a.kt)("p",null,"When the application has activated authorization with 'zitadel' profile, all protected APIs must have an\n",(0,a.kt)("inlineCode",{parentName:"p"},"Authorization")," header in the ",(0,a.kt)("inlineCode",{parentName:"p"},"Bearer ${access token}")," format in the http request.\nHere are two ways to get access_token for executing authenticated APIs:"),(0,a.kt)("p",null,"The first way is to open the Swagger-UI page of the Xpanse server.\nIn case of local development server, the Swagger-UI is reachable on ",(0,a.kt)("inlineCode",{parentName:"p"},"http://localhost:8080/swagger-ui/index.html"),".\n",(0,a.kt)("img",{alt:"Browser open openAPI page",src:n(31496).Z,width:"1920",height:"1040"})),(0,a.kt)("p",null,"Click on the 'Authorize' button on the SwaggerUI page to open the authentication window.\nClick on the 'select all' option to select all 'Scopes' and click on 'Authorize'\n",(0,a.kt)("img",{alt:"Authorize in the authentication window",src:n(22570).Z,width:"1920",height:"969"})),(0,a.kt)("p",null,"The browser will redirect to the login page of the IAM service.\nFill username and password to complete user login.\nOnce the login is successful, the control is automatically redirected to the Swagger-UI page.\nClose the authentication window and select the API which you want to execute and click to expand it,\nthen click on 'Try it out' and 'Execute' to execute the API method.\nIn the Curl command, you can see the request header named ",(0,a.kt)("inlineCode",{parentName:"p"},"Authorization")," with the value of\n${access_token} after prefix ",(0,a.kt)("inlineCode",{parentName:"p"},"Bearer "),".\n",(0,a.kt)("img",{alt:"Execute APIs using openAPI page",src:n(93981).Z,width:"1920",height:"969"})),(0,a.kt)("p",null,"The other way is to use the ",(0,a.kt)("inlineCode",{parentName:"p"},"Authorize")," REST API.\nCall the method using browser.\nIn case of local development server, the URL is ",(0,a.kt)("inlineCode",{parentName:"p"},"http://localhost:8080/auth/authorize"),".\nThe browser will redirect to the login page of the IAM service.\nFill username and password to complete user login.\nAfter successful login in the IAM, the browser will back to the token API\nurl with response model 'TokenResponse' with field 'access_token.'\nThen you can use the value of 'access_token' to fill header 'Authorization' in the http request when executing\nauthenticated APIs with CLI or the other http client tools.\n",(0,a.kt)("img",{alt:"Authorized access token response",src:n(68565).Z,width:"1914",height:"210"})))}p.isMDXComponent=!0},22570:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/authorize-in-authorization-window-e0955a4d6c19522117ed75bce6cd6af2.png"},68565:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/authorized-access-token-response-8ac1b898817ad8f597d7be1d36448c90.png"},31496:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/browser-open-openapi-page-924a8594091c8f4123856d9cb922f079.png"},93981:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/execute-api-in-openapi-page-64ff564b8f208d2a42f222fd50223b46.png"}}]);