"use strict";(self.webpackChunkxpanse_website=self.webpackChunkxpanse_website||[]).push([[7230],{2087:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"runtime","title":"Runtime","description":"xpanse runtime is the running module built on SpringBoot.","source":"@site/docs/runtime.mdx","sourceDirName":".","slug":"/runtime","permalink":"/xpanse/docs/runtime","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8},"sidebar":"tutorialSidebar","previous":{"title":"Request Audit","permalink":"/xpanse/docs/request-audit"},"next":{"title":"Sensitive Data","permalink":"/xpanse/docs/senstive-data"}}');var t=i(4848),s=i(8453),a=i(7346);const o={sidebar_position:8},l="Runtime",d={},c=[{value:"Pre-Requisites",id:"pre-requisites",level:2},{value:"Properties and Environment Variables",id:"properties-and-environment-variables",level:2},{value:"Local Development",id:"local-development",level:3},{value:"Clone and Build",id:"clone-and-build",level:4},{value:"Run",id:"run",level:4},{value:"From Command Line",id:"from-command-line",level:5},{value:"From IDE",id:"from-ide",level:5},{value:"Production",id:"production",level:3},{value:"Run using jar",id:"run-using-jar",level:4},{value:"Run using Docker image",id:"run-using-docker-image",level:4},{value:"Running API behind a proxy",id:"running-api-behind-a-proxy",level:4}];function h(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"runtime",children:"Runtime"})}),"\n",(0,t.jsx)(n.p,{children:"xpanse runtime is the running module built on SpringBoot."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"xpanse Runtime"})," supports two kinds of deployers: terraform and open tofu."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"xpanse Runtime"})," has two ways to invoke ",(0,t.jsx)(n.code,{children:"terraform"}),", one is to use the local terraform module, the other is use\nthe remote terraform-boot service. The remote terraform-boot service is used by default."]}),"\n",(0,t.jsxs)(n.p,{children:["Similarly, ",(0,t.jsx)(n.code,{children:"xpanse Runtime"})," has two ways to invoke ",(0,t.jsx)(n.code,{children:"open tofu"}),", one is to use the local open tofu module,\nthe other is use the remote terraform-boot service. The remote terraform-boot service is used by default."]}),"\n",(0,t.jsx)(n.h2,{id:"pre-requisites",children:"Pre-Requisites"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["If using local terraform module, the ",(0,t.jsx)(n.code,{children:"xpanse Runtime"})," host must have ",(0,t.jsx)(n.code,{children:"Terraform CLI"})," installed."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["If using remote terraform-boot service, a remote ",(0,t.jsx)(n.code,{children:"terraform-boot"})," service must be\ndeployed/started. More details about the Terraform-boot project can be found ",(0,t.jsx)(a.A,{name:"here",url:"https://github.com/eclipse-xpanse/terraform-boot/blob/main/README.md"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["If using local open tofu module, the ",(0,t.jsx)(n.code,{children:"xpanse Runtime"})," host must have ",(0,t.jsx)(n.code,{children:"Open Tofu CLI"})," installed."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["If using remote terraform-boot service, a remote ",(0,t.jsx)(n.code,{children:"tofu-maker"})," service must be\ndeployed/started. More details about the Terraform-boot project can be found ",(0,t.jsx)(a.A,{name:"here",url:"https://github.com/eclipse-xpanse/tofu-maker/blob/main/README.md"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Fully configured Zitadel instance."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"properties-and-environment-variables",children:"Properties and Environment Variables"}),"\n",(0,t.jsx)(n.p,{children:"xpanse has integration to multiple systems, and the aim is also to keep the system as flexible as\npossible and to cover all use-cases possible. Therefore, there are some configuration properties\nthat the developer and the production administrators must take care of before starting/deploying\nxpanse."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Configuration properties of authentication layer.\nDocumented ",(0,t.jsx)(a.A,{name:"here",url:"./authentication-authorization",isOpenInNewTab:!1}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Configuration properties of database layer. Documented ",(0,t.jsx)(a.A,{name:"here",url:"./database#mysql-db",isOpenInNewTab:!1}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Plugin activation variables. Documented ",(0,t.jsx)(a.A,{name:"here",url:"./plugins#plugin-activation",isOpenInNewTab:!1}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"local-development",children:"Local Development"}),"\n",(0,t.jsx)(n.h4,{id:"clone-and-build",children:"Clone and Build"}),"\n",(0,t.jsx)(n.p,{children:"Clone the project using the command below"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ git clone https://github.com/eclipse-xpanse/xpanse\n$ cd xpanse\n"})}),"\n",(0,t.jsx)(n.p,{children:"Then compile the entire project using the below command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ ./mvnw clean install -DskipTests\n"})}),"\n",(0,t.jsxs)(n.p,{children:["By default, the compile process will enable all plugins supported by xpanse. If you want to enable a specific plugin,\nadd the flag ",(0,t.jsx)(n.code,{children:"-Pplugin-xxx"})," in the command line to enable the specific plugin."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ ./mvnw clean install -DskipTests -Pplugin-huawei\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The specific plugin profile in the flag ",(0,t.jsx)(n.code,{children:"-Pplugin-xxx"})," can enable the plugin for the cloud service provider as below:"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"-Pplugin-huawei"})," to enable the plugin for HUAWEI CLOUD.\n",(0,t.jsx)(n.code,{children:"-Pplugin-flexibleengine"})," to enable the plugin for Flexible Engine Cloud.\n",(0,t.jsx)(n.code,{children:"-Pplugin-openstack"})," to enable the plugin for Openstack Cloud.\n",(0,t.jsx)(n.code,{children:"-Pplugin-scs"})," to enable the plugin for SCS Cloud."]}),"\n",(0,t.jsx)(n.h4,{id:"run",children:"Run"}),"\n",(0,t.jsxs)(n.p,{children:["Ensure all properties mentioned in the ",(0,t.jsx)(a.A,{name:"above section",url:"./runtime#properties-and-environment-variables",isOpenInNewTab:!1})," are\ncorrectly set."]}),"\n",(0,t.jsx)(n.h5,{id:"from-command-line",children:"From Command Line"}),"\n",(0,t.jsx)(n.p,{children:"If you have a fully configured Zitadel instance running on your local system, then you can use the\nbelow command to start the application by passing all variables."}),"\n",(0,t.jsx)(n.p,{children:"To start the application from the command line, run the below application from the root of the\nproject."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ java -jar runtime/target/xpanse-runtime-1.0.8-SNAPSHOT.jar\n"})}),"\n",(0,t.jsx)(n.admonition,{title:"Plugins in runtime",type:"danger",children:(0,t.jsx)(n.p,{children:"If the executable jar packaged with the specific plugin profile, the running service only supports the specific\ncloud service provider."})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-properties",children:"spring.profiles.active=oauth,zitadel,zitadel-testbed,terraform-boot,tofu-maker\n"})}),"\n",(0,t.jsxs)(n.p,{children:["By default, ",(0,t.jsx)(n.code,{children:"xpanse Runtime"})," starts with our ",(0,t.jsx)(n.code,{children:"zitadel-testbed"}),". If you would not like to use our ",(0,t.jsx)(n.code,{children:"zitadel-testbed"}),",\nyou can start the server using the below command by update the ",(0,t.jsx)(n.code,{children:"spring.profiles.active"})," property and with all the required variables."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ cd runtime/target\n$ java -jar runtime/target/xpanse-runtime-1.0.8-SNAPSHOT.jar \\\n--spring.profiles.active=oauth,zitadel,terraform-boot,tofu-maker\n--authorization-api-client-id=${client-id} \\\n--authorization-api-client-secret=${client-secret} \\\n--authorization-swagger-ui-client-id=${swagger-ui-cleint-id}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["By default, ",(0,t.jsx)(n.code,{children:"xpanse Runtime"})," starts with terraform-boot and tofu-maker. If you want to use local terraform and\nlocal open tofu, just don't activate the terraform-boot and tofu-maker scenario in the application.properties\nconfiguration file. Use the below start command line with the value of the property ",(0,t.jsx)(n.code,{children:"spring.profiles.active"}),"\nremoved the profile flag ",(0,t.jsx)(n.code,{children:"terraform-boot"})," and ",(0,t.jsx)(n.code,{children:"tofu-maker"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ java -jar runtime/target/xpanse-runtime-*-SNAPSHOT.jar \\\n--spring.profiles.active=oauth,zitadel,zitadel-testbed\n"})}),"\n",(0,t.jsx)(n.h5,{id:"from-ide",children:"From IDE"}),"\n",(0,t.jsx)(n.p,{children:"Or the application can be started using the IDE by executing the main application directly. Below is\nthe example from IntellijIdea"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"ide-run.png",src:i(9313).A+"",width:"800",height:"676"})}),"\n",(0,t.jsx)(n.p,{children:"You must see the below messages in the console."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'\n   _  __   ____    ____ _   ____    _____  ___\n  | |/_/  / __ \\  / __ `/  / __ \\  / ___/ / _ \\\n _>  <   / /_/ / / /_/ /  / / / / (__  ) /  __/\n/_/|_|  / .___/  \\__,_/  /_/ /_/ /____/  \\___/\n       /_/\n\n        xpanse 1.0.8-SNAPSHOT (2023)\n11:33:13.144 [main] INFO  o.e.xpanse.runtime.XpanseApplication []- Starting XpanseApplication using Java 21.0.1 with PID 9440 (D:\\IdeaProjects\\xpanse\\runtime\\target\\classes started by Administrator in D:\\IdeaProjects\\xpanse)\n11:33:13.146 [main] INFO  o.e.xpanse.runtime.XpanseApplication []- The following 5 profiles are active: "zitadel", "zitadel-testbed", "terraform-boot", "tofu-maker"\n11:33:23.783 [main] INFO  o.e.x.m.orchestrator.PluginManager []- List cloud service providers:[SCS, HUAWEI, FLEXIBLE_ENGINE, OPENSTACK] with activate plugins.\n11:33:23.793 [main] INFO  o.e.x.m.s.IdentityProviderManager []- Identity provider service with type:ZITADEL is active.\n11:33:29.116 [main] INFO  o.e.xpanse.runtime.XpanseApplication []- Started XpanseApplication in 16.584 seconds (process running for 17.701)\n'})}),"\n",(0,t.jsx)(n.p,{children:"You can check the status of the runtime by opening the swagger UI from any browser:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"http://localhost:8080/swagger-ui/index.html\n"})}),"\n",(0,t.jsx)(n.h3,{id:"production",children:"Production"}),"\n",(0,t.jsxs)(n.p,{children:["Ensure all properties mentioned in the ",(0,t.jsx)(a.A,{name:"above section",url:"./runtime#properties-and-environment-variables",isOpenInNewTab:!1})," are\ncorrectly set."]}),"\n",(0,t.jsx)(n.h4,{id:"run-using-jar",children:"Run using jar"}),"\n",(0,t.jsxs)(n.p,{children:["Download the released runtime jar from GitHub releases. You can get the latest from ",(0,t.jsx)(a.A,{name:"here",url:"https://github.com/eclipse-xpanse/xpanse/releases/latest"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["After downloading, follow the same steps mentioned in ",(0,t.jsx)(a.A,{name:"this",url:"runtime#from-command-line"})," section."]}),"\n",(0,t.jsx)(n.h4,{id:"run-using-docker-image",children:"Run using Docker image"}),"\n",(0,t.jsx)(n.p,{children:"You can start the runtime using our released docker image, and this is the preferred way. This image\ncontains all necessary tools preinstalled."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'$ docker pull ghcr.io/eclipse-xpanse/xpanse:${release-version}\n$ docker run -d -p 8080:8080 --name xpanse -e "SPRING_PROFILES_ACTIVE=oauth,zitadel,mysql" ghcr.io/eclipse-xpanse/xpanse:${release-version}\n$ docker logs xpanse\n'})}),"\n",(0,t.jsx)(n.admonition,{title:"Avoid properties in command line",type:"danger",children:(0,t.jsxs)(n.p,{children:["It's safe to provide all properties as environment variables rather than passing them directly in the command line.\nIn case of this, the same property name must be set in UPPERCASE for all 4 variables.\nFor running, using docker image, we can use the ",(0,t.jsx)(n.code,{children:" --env-file"})," option of the ",(0,t.jsx)(n.code,{children:"docker run"})," command to store all sensitive data.\nAgain here the property names must be in UPPERCASE."]})}),"\n",(0,t.jsx)(n.h4,{id:"running-api-behind-a-proxy",children:"Running API behind a proxy"}),"\n",(0,t.jsxs)(n.p,{children:["For running the runtime application behind a proxy, we must ensure that the proxy forwards the\ncorrect ",(0,t.jsx)(n.code,{children:"X-Forwarded-*"}),"headers to the API. This is necessary as the API has some features where the\nlinks to HTML pages are returned and this link will have the correct protocol and host only when\nthese headers are set."]}),"\n",(0,t.jsx)(n.p,{children:"In the case of NGINX, the configuration will look like this"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-nginx",metastring:"configuration",children:"proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\nproxy_set_header X-Forwarded-Proto https;\nproxy_set_header Host $host;\n"})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},7346:(e,n,i)=>{i.d(n,{A:()=>t});i(6540);var r=i(4848);function t(e){let{name:n,url:i,isOpenInNewTab:t=!0}=e;return(0,r.jsx)("a",{href:i,className:"link-text",target:t?"_blank":"_self",children:n})}},9313:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/ide-run-00783465c9acc0434e6a18eb6db9b6bc.png"},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var r=i(6540);const t={},s=r.createContext(t);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);